<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Table</title>
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='components_result.css') }}"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  </head>
  <body>
    <div class="table-container">
      <h1>Establishments</h1>
      <div class="table-description">
        Establishments obtained from the selected region.
      </div>
      <div class="table-buttons">
        <div class="btn-group">
          <button class="btn-outline">Delete</button>
          <button class="btn-outline">Filters</button>
          <button class="btn-outline">Export</button>
          <button class="btn-primary">+ Add establishment</button>
        </div>
      </div>
      <table id="example" class="display">
        <thead>
          <tr>
            <th><input type="checkbox" id="select-all" /></th>
            <th>place_id</th>
            <th>lat</th>
            <th>lon</th>
            <th>business_status</th>
            <th>name</th>
            <th>rating</th>
            <th>types</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="footer-buttons">
      <button class="btn-blue">Continue</button>
      <button class="btn-outline">Coordinates</button>
      <button class="btn-outline">Results</button>
      <button class="btn-outline">Categories</button>
    </div>

    <script>
      $(document).ready(function () {
        var table = $("#example").DataTable({
          paging: false,
          info: false,
          ordering: true,
        });

        $("#select-all").on("click", function () {
          var rows = table.rows({ search: "applied" }).nodes();
          $('input[type="checkbox"]', rows).prop("checked", this.checked);
        });

        Papa.parse("/static/data/output/establishments.csv", {
          download: true,
          header: true,
          complete: function (results) {
            var data = results.data;
            if (data.length === 0) {
              console.error("No data found");
            } else {
              data.forEach(function (row) {
                table.row
                  .add([
                    '<input type="checkbox" class="row-checkbox">',
                    row.place_id,
                    row.lat,
                    row.lon,
                    row.business_status,
                    row.name,
                    row.rating,
                    row.types,
                  ])
                  .draw(false);
              });
            }
          },
          error: function (error) {
            console.error("Error loading CSV", error);
          },
        });
      });
    </script>
  </body>
</html>
